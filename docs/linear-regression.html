<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Linear Regression | Linear Regression</title>
  <meta name="description" content="Chapter 2 Linear Regression | Linear Regression" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Linear Regression | Linear Regression" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Linear Regression | Linear Regression" />
  
  
  

<meta name="author" content="Sam Jasper and Jackson de Oliveira" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="logistic-regression.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TRTADSF</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> To Rule Them All: DS Flowcharts</a></li>
<li class="chapter" data-level="2" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>2</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="2.1" data-path="linear-regression.html"><a href="linear-regression.html#select-alpha-level"><i class="fa fa-check"></i><b>2.1</b> Select Alpha Level</a></li>
<li class="chapter" data-level="2.2" data-path="linear-regression.html"><a href="linear-regression.html#create-linear-model-of-all-variables"><i class="fa fa-check"></i><b>2.2</b> Create Linear Model of All Variables</a></li>
<li class="chapter" data-level="2.3" data-path="linear-regression.html"><a href="linear-regression.html#global-f-test"><i class="fa fa-check"></i><b>2.3</b> Global F-Test</a></li>
<li class="chapter" data-level="2.4" data-path="linear-regression.html"><a href="linear-regression.html#assumptions"><i class="fa fa-check"></i><b>2.4</b> Assumptions</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="linear-regression.html"><a href="linear-regression.html#linearity"><i class="fa fa-check"></i><b>2.4.1</b> Linearity</a></li>
<li class="chapter" data-level="2.4.2" data-path="linear-regression.html"><a href="linear-regression.html#independent-random-errors"><i class="fa fa-check"></i><b>2.4.2</b> Independent Random Errors</a></li>
<li class="chapter" data-level="2.4.3" data-path="linear-regression.html"><a href="linear-regression.html#random-errors-normally-distributed"><i class="fa fa-check"></i><b>2.4.3</b> Random Errors Normally Distributed</a></li>
<li class="chapter" data-level="2.4.4" data-path="linear-regression.html"><a href="linear-regression.html#random-error-constant-variance"><i class="fa fa-check"></i><b>2.4.4</b> Random Error Constant Variance</a></li>
<li class="chapter" data-level="2.4.5" data-path="linear-regression.html"><a href="linear-regression.html#single-predictor"><i class="fa fa-check"></i><b>2.4.5</b> Single Predictor?</a></li>
<li class="chapter" data-level="2.4.6" data-path="linear-regression.html"><a href="linear-regression.html#multiple-predictors"><i class="fa fa-check"></i><b>2.4.6</b> Multiple Predictors</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="linear-regression.html"><a href="linear-regression.html#influential-observations-outliers"><i class="fa fa-check"></i><b>2.5</b> Influential Observations / Outliers</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="linear-regression.html"><a href="linear-regression.html#identify-influential-observations"><i class="fa fa-check"></i><b>2.5.1</b> Identify influential observations</a></li>
<li class="chapter" data-level="2.5.2" data-path="linear-regression.html"><a href="linear-regression.html#handle-outliers"><i class="fa fa-check"></i><b>2.5.2</b> Handle Outliers</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="linear-regression.html"><a href="linear-regression.html#variable-selection"><i class="fa fa-check"></i><b>2.6</b> Variable Selection</a></li>
<li class="chapter" data-level="2.7" data-path="linear-regression.html"><a href="linear-regression.html#model-evaluation"><i class="fa fa-check"></i><b>2.7</b> Model Evaluation</a></li>
<li class="chapter" data-level="2.8" data-path="linear-regression.html"><a href="linear-regression.html#summarize-findings"><i class="fa fa-check"></i><b>2.8</b> Summarize Findings</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>3</b> Logistic Regression</a></li>
<li class="chapter" data-level="4" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>4</b> Time Series</a></li>
<li class="chapter" data-level="5" data-path="data-mining.html"><a href="data-mining.html"><i class="fa fa-check"></i><b>5</b> Data Mining</a></li>
<li class="chapter" data-level="6" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>6</b> Machine Learning</a></li>
<li class="chapter" data-level="7" data-path="survival-analysis.html"><a href="survival-analysis.html"><i class="fa fa-check"></i><b>7</b> Survival Analysis</a></li>
<li class="chapter" data-level="8" data-path="text-analytics.html"><a href="text-analytics.html"><i class="fa fa-check"></i><b>8</b> Text Analytics</a></li>
<li class="chapter" data-level="9" data-path="analytics-additional-topics.html"><a href="analytics-additional-topics.html"><i class="fa fa-check"></i><b>9</b> Analytics: Additional Topics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="analytics-additional-topics.html"><a href="analytics-additional-topics.html#data-cleaning"><i class="fa fa-check"></i><b>9.1</b> Data Cleaning</a></li>
<li class="chapter" data-level="9.2" data-path="analytics-additional-topics.html"><a href="analytics-additional-topics.html#ensemble-models"><i class="fa fa-check"></i><b>9.2</b> Ensemble Models</a></li>
<li class="chapter" data-level="9.3" data-path="analytics-additional-topics.html"><a href="analytics-additional-topics.html#transforms"><i class="fa fa-check"></i><b>9.3</b> Transforms</a></li>
<li class="chapter" data-level="9.4" data-path="analytics-additional-topics.html"><a href="analytics-additional-topics.html#regularized-regression"><i class="fa fa-check"></i><b>9.4</b> Regularized Regression</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="programming-r.html"><a href="programming-r.html"><i class="fa fa-check"></i><b>10</b> Programming: R</a></li>
<li class="chapter" data-level="11" data-path="programming-python.html"><a href="programming-python.html"><i class="fa fa-check"></i><b>11</b> Programming: Python</a></li>
<li class="chapter" data-level="12" data-path="programming-sql.html"><a href="programming-sql.html"><i class="fa fa-check"></i><b>12</b> Programming: SQL</a></li>
<li class="chapter" data-level="13" data-path="programming-cloud-computing.html"><a href="programming-cloud-computing.html"><i class="fa fa-check"></i><b>13</b> Programming: Cloud Computing</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Linear Regression</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linear-regression" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Linear Regression</h1>
<div id="htmlwidget-b55591ca440cbb6ba1a6" style="width:768px;height:1344px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-b55591ca440cbb6ba1a6">{"x":{"diagram":"digraph {\n  graph [layout = dot, rankdir = TB]\n  \n  node [shape = rectangle, fontsize=40, style=filled, color=\"lightblue1\"]\n  0 [label = \"START HERE!\", color=\"chocolate1\", style=filled, URL=\"#select-alpha-level\", fontcolor=\"blue\"]\n  1 [label = \"Build a linear model with all variables\", URL=\"#create-linear-model-of-all-variables\", fontcolor=\"blue\"]\n  H [label = \"Re-evaluate Variables \n  and/or Model Type\"]\n  10 [label = \"1. WLS/IRLS\n  2. Transform\n  3. Different Distribution\"]\n  13 [label = \"Remove Var(s) or \n  Create new transformed vars\"]\n  14 [label = \"Handle Influential \n  Observations\", URL=\"#influential-observations-outliers\", fontcolor=\"blue\"]\n  15 [label = \"Select Variable Evaluation\n  Statistic\"]\n  16 [label = \"Select Variable \n  Selection Technique\", URL=\"#variable-selection\", fontcolor=\"blue\"]\n  17 [label = \"Select Model \n  Evaluation Statistic\", URL=\"#model-evaluation\", fontcolor=\"blue\"]\n  18 [label = \"Summarize\n  Findings\", URL=\"#summarize-findings\", fontcolor=\"blue\"]\n  \n  node [shape = diamond, fontsize=40, style=filled, color=cornsilk2]\n  2 [label = \"Is a global F-Test \n  significant?\", URL=\"#global-f-test\", fontcolor=\"blue\"]\n  3 [label = \"Test Assumptions: \n  Linearity of the mean\", URL=\"#linearity\", fontcolor=\"blue\"]\n  6 [label = \"Residuals Polynomial?\n  Use Higher Order\"]\n  4 [label = \"Test Assumptions: \n  Independent Random Errors\", URL=\"#independent-random-errors\", fontcolor=\"blue\"]\n  5 [label = \"Test Assumptions:\n  Normality\", URL=\"#random-errors-normally-distributed\", fontcolor=\"blue\"]\n  7 [label = \"Box Cox \n  Transform\"]\n  8 [label = \"Transform \n  X-Values\"]\n  9 [label = \"Test Assumptions: \n  Constant Variance\", URL=\"#random-error-constant-variance\", fontcolor=\"blue\"]\n  11 [label = \"Multiple \n  X-Vars?\", URL=\"#single-predictor\", fontcolor=\"blue\"]\n  12 [label = \"Any VIF \n  > 10?\", URL=\"#check-for-multicollinearity\", fontcolor=\"blue\"]\n\n  \n  # edge definitions with the node IDs\n  0 -> 1 [style=bold]\n  1 -> 2 [style=bold]\n  H -> 1 [style=bold]\n  2 -> H [label = \"No\", fontsize=40, style=dashed]\n  2 -> 3 [label = \"Yes\", fontsize=40, style=bold]\n  3 -> 4 [label = \"Yes\", fontsize=40, style=bold]\n  3 -> 6 [label = \"No\", fontsize=40, style=dashed]\n  6 -> H [label = \"Yes\", fontsize=40, style=bold]\n  6 -> H [label = \"No\", fontsize=40, style=dashed]\n  4 -> 5 [label = \"Yes\", fontsize=40, style=bold]\n  4 -> H [label = \"No\", fontsize=40, style=dashed]\n  5 -> 7 [label = \"No\", fontsize=40, style=dashed]\n  7 -> 8 [label = \"No\", fontsize=40, style=dashed]\n  8 -> H [label = \"No\", fontsize=40, style=dashed]\n  5 -> 9 [label = \"Normal\", fontsize=40, style=bold]\n  7 -> 9 [label = \"Normal\", fontsize=40, style=bold]\n  8 -> 9 [label = \"Normal\", fontsize=40, style=bold]\n  9 -> 10 [label = \"No\", fontsize=40, style=dashed]\n  10 -> H [label = \"No\", fontsize=40, style=dashed]\n  9 -> 11 [label = \"Yes\", fontsize=40, style=bold]\n  11 -> 12 [label = \"Yes\", fontsize=40, style=bold]\n  12 -> 13 [label = \"Yes\", fontsize=40, style=bold]\n  11 -> 14 [label = \"No\", fontsize=40, style=dashed]\n  13 -> 14 [style=bold]\n  12 -> 14 [label = \"No\", fontsize=40, style=dashed]\n  14 -> 15 [style=bold]\n  15 -> 16 [style=bold]\n  16 -> 17 [style=bold]\n  17 -> 18 [style=bold]\n  \n\n  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<div id="select-alpha-level" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Select Alpha Level</h2>
<p><span style="color:blue;"> <em>snippet fsr_alpha </em></span> <a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a></p>
<p>There are three ways to select an alpha level prior to modeling. You can stick with the standard 0.05 cutoff, use the below sample size table (from a paper by Raftery), or use the below calculation based on sample size.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="linear-regression.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Determines alpha value based on sample size and BIC criterion</span></span>
<span id="cb2-2"><a href="linear-regression.html#cb2-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">pchisq</span>(<span class="fu">log</span>(<span class="fu">nrow</span>(dataset)),<span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="create-linear-model-of-all-variables" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Create Linear Model of All Variables</h2>
<p><a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a></p>
<p>Assuming you have a reasonable number of variables, start by putting them all into a model to predict the target. Variable selection/ reduction will occur later in the process. If you have a large number of variables, you can consider variable reduction or a different analytical technique.</p>
</div>
<div id="global-f-test" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Global F-Test</h2>
<p><span style="color:blue;"> <em>snippet fsr_globalF</em> </span> <a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a></p>
<p>Once the linear model is created, a Global F test will discern if any of the variables are significant in predicting y. If no variables are significant, you should re-evaluate the variables or the model selected for this business problem. Assuming at least one variable is significant, continue with the modeling process.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="linear-regression.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Global F test: Determines if at least one variable is significant</span></span>
<span id="cb3-2"><a href="linear-regression.html#cb3-2" aria-hidden="true" tabindex="-1"></a>lm.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(targetvar <span class="sc">~</span> predvar1 <span class="sc">+</span> predvar2, <span class="at">data =</span> dataset)</span>
<span id="cb3-3"><a href="linear-regression.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.model)</span></code></pre></div>
</div>
<div id="assumptions" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Assumptions</h2>
<p><a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a>
Next, you need to assess a number of assumptions that come with linear regression modeling. First evaluate if the predictor variables have a linear relationship with the response by evaluating their shape when plotted. If the variable looks like a quadratic (curve), polynomial, or not straight consider going back and creating higher order terms.</p>
<div id="linearity" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Linearity</h3>
<p><span style="color:blue;"> <em>snippet fsr_assumptions_linearity</em> </span> <a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a></p>
<p>Check if they are linear (yes, keep moving)
(No) If they look polynomial/ quadratic/ etc. reconsider higher order terms</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="linear-regression.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check to see if the below plot is random with an average value of zero</span></span>
<span id="cb4-2"><a href="linear-regression.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-3"><a href="linear-regression.html#cb4-3" aria-hidden="true" tabindex="-1"></a>lm.model<span class="ot">=</span><span class="fu">lm</span>(targetvar<span class="sc">~</span>.,<span class="at">data=</span>dataset)</span>
<span id="cb4-4"><a href="linear-regression.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lm.model,<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">fitted</span>(lm.model),<span class="at">y=</span><span class="fu">resid</span>(lm.model))) <span class="sc">+</span></span>
<span id="cb4-5"><a href="linear-regression.html#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;blue&quot;</span>)<span class="sc">+</span></span>
<span id="cb4-6"><a href="linear-regression.html#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Predicted Values&quot;</span>,<span class="at">y=</span><span class="st">&quot;Residuals&quot;</span>)</span></code></pre></div>
</div>
<div id="independent-random-errors" class="section level3" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Independent Random Errors</h3>
<p><span style="color:blue;"> <em>snippet fsr_assumptions_independence </em></span> <a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a></p>
<p>Next check is the errors are independent by inspecting if the residuals show a pattern. This can also be determined statistically with the Durbin-Watson test.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="linear-regression.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Can use plot to visually see time-dependence or use Durbin-Watson test</span></span>
<span id="cb5-2"><a href="linear-regression.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-3"><a href="linear-regression.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb5-4"><a href="linear-regression.html#cb5-4" aria-hidden="true" tabindex="-1"></a>lm.model<span class="ot">=</span><span class="fu">lm</span>(targetvar<span class="sc">~</span>.,<span class="at">data=</span>dataset)</span>
<span id="cb5-5"><a href="linear-regression.html#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="linear-regression.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train,<span class="fu">aes</span>(<span class="at">x=</span>timevariable,<span class="at">y=</span>lm.model<span class="sc">$</span>residuals)) <span class="sc">+</span>  <span class="co">#i. Visual Plot</span></span>
<span id="cb5-7"><a href="linear-regression.html#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-8"><a href="linear-regression.html#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x=</span><span class="st">&quot;Time&quot;</span>,<span class="at">y=</span><span class="st">&quot;Residuals&quot;</span>)</span>
<span id="cb5-9"><a href="linear-regression.html#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="linear-regression.html#cb5-10" aria-hidden="true" tabindex="-1"></a>lm.model<span class="ot">=</span><span class="fu">lm</span>(targetvar<span class="sc">~</span>timevariable,<span class="at">data=</span>dataset)</span>
<span id="cb5-11"><a href="linear-regression.html#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dwtest</span>(lm.model,<span class="at">alternative=</span><span class="st">&quot;greater&quot;</span>) <span class="co">#ii. Durbin-Watson test</span></span></code></pre></div>
</div>
<div id="random-errors-normally-distributed" class="section level3" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Random Errors Normally Distributed</h3>
<p><span style="color:blue;"> <em>snippet fsr_assumptions_normdist </em></span> <a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a></p>
<p>Next, there are three ways to check that the random errors are normally distribution. You can evaluate a histogram of the residuals, create a qq plot and look for a straight line, or do a formal test. The formal test is either Anderson-Darling or Shapiro-Wilk. Shapiro-Wilk is commonly used for smaller data sets. If the errors are not normal, consider a transformation such as box-cox or a log of the x’s.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="linear-regression.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check to see if the below plot has a constant spread over the range of predicted values</span></span>
<span id="cb6-2"><a href="linear-regression.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Can use QQ-plot, Anderson-Darling test, or Shapiro-Wilk test</span></span>
<span id="cb6-3"><a href="linear-regression.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-4"><a href="linear-regression.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nortest)</span>
<span id="cb6-5"><a href="linear-regression.html#cb6-5" aria-hidden="true" tabindex="-1"></a>lm.model<span class="ot">=</span><span class="fu">lm</span>(targetvar<span class="sc">~</span>.,<span class="at">data=</span>dataset)</span>
<span id="cb6-6"><a href="linear-regression.html#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="linear-regression.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dataset, <span class="fu">aes</span>(<span class="at">sample =</span> lm.model<span class="sc">$</span>residuals)) <span class="sc">+</span> <span class="co">#i. QQ-Plot</span></span>
<span id="cb6-8"><a href="linear-regression.html#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb6-9"><a href="linear-regression.html#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>()</span>
<span id="cb6-10"><a href="linear-regression.html#cb6-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-11"><a href="linear-regression.html#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ad.test</span>(lm.model<span class="sc">$</span>residuals) <span class="co">#ii. Anderson-Darling test. Gives more weight to tails</span></span>
<span id="cb6-12"><a href="linear-regression.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(lm.model<span class="sc">$</span>residuals) <span class="co">#iii. Shapiro-Wilk test. Better for smaller data sets</span></span></code></pre></div>
</div>
<div id="random-error-constant-variance" class="section level3" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> Random Error Constant Variance</h3>
<p><span style="color:blue;"> <em>snippet fsr_assumptions_constvar </em></span> <a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a></p>
<p>Then you need to further inspect the residuals by looking for patterns. If the residuals visually have a constant variance, then the random error assumption is met. This can also be evaluated statistically with the Spearman Rank Correlation. Values close to 0 mean the variance is constant. If it’s not constant (visually or a spearman rank correlation close to 1 or -1) consider alternative options such as weighted least squares, transforming the data, or a different distribution (ex: Poisson)</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="linear-regression.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check to see if the below plot has a constant spread over the range of predicted values</span></span>
<span id="cb7-2"><a href="linear-regression.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-3"><a href="linear-regression.html#cb7-3" aria-hidden="true" tabindex="-1"></a>lm.model<span class="ot">=</span><span class="fu">lm</span>(targetvar<span class="sc">~</span>.,<span class="at">data=</span>dataset)</span>
<span id="cb7-4"><a href="linear-regression.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lm.model,<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">fitted</span>(lm.model),<span class="at">y=</span><span class="fu">resid</span>(lm.model))) <span class="sc">+</span></span>
<span id="cb7-5"><a href="linear-regression.html#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="linear-regression.html#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Predicted Values&quot;</span>,<span class="at">y=</span><span class="st">&quot;Residuals&quot;</span>)</span></code></pre></div>
</div>
<div id="single-predictor" class="section level3" number="2.4.5">
<h3><span class="header-section-number">2.4.5</span> Single Predictor?</h3>
<p><a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a>
The final assumption to check is multicollinearity. If you only have 1 predictor, you can skip this step.</p>
</div>
<div id="multiple-predictors" class="section level3" number="2.4.6">
<h3><span class="header-section-number">2.4.6</span> Multiple Predictors</h3>
<div id="check-for-multicollinearity" class="section level4" number="2.4.6.1">
<h4><span class="header-section-number">2.4.6.1</span> Check for Multicollinearity</h4>
<p><span style="color:blue;"> <em>snippet fsr_assumptions_multicol </em></span> <a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a></p>
<p>If you have multiple predictors check multicollinearity with VIF. If VIF is greater than 10, there is multicollinearity and you should remove the related variable or transform the variable. If the VIF is less than 10, continue on to influential observations/ outliers.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="linear-regression.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check for correlation among predictor variables or calculate the variance inflation factor (VIF)</span></span>
<span id="cb8-2"><a href="linear-regression.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb8-3"><a href="linear-regression.html#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="linear-regression.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#First filter dataframe to only contain numeric variables</span></span>
<span id="cb8-5"><a href="linear-regression.html#cb8-5" aria-hidden="true" tabindex="-1"></a>dataset_num <span class="ot">=</span> dataset[,<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">82</span>)]</span>
<span id="cb8-6"><a href="linear-regression.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(dataset_num) <span class="co">#i. Correlation among predictor variables</span></span>
<span id="cb8-7"><a href="linear-regression.html#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="linear-regression.html#cb8-8" aria-hidden="true" tabindex="-1"></a>lm.model<span class="ot">=</span><span class="fu">lm</span>(targetvar<span class="sc">~</span>.,<span class="at">data=</span>dataset)</span>
<span id="cb8-9"><a href="linear-regression.html#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(lm.model) <span class="co">#ii. Variance inflation factor (VIF)</span></span></code></pre></div>
</div>
</div>
</div>
<div id="influential-observations-outliers" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Influential Observations / Outliers</h2>
<p><a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a>
Once all of the assumptions are met, consider handling influential observations and outliers. The strategies below to help identify influential observations, and 5 strategies to handle them once detected.</p>
<div id="identify-influential-observations" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Identify influential observations</h3>
<p><span style="color:blue;"> <em>snippet fsr_influential</em></span> <a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a></p>
<ul>
<li>Internally Studentized residuals (good for detecting outliers)</li>
<li>Externally Studentized residuals (good for detecting outliers)</li>
<li>Cook’s D (good for detecting influential observations)</li>
<li>DFFITS (good for detecting influential observations)</li>
<li>DFBETAS (good for detecting influential observations)</li>
<li>Hat values (good for detecting influential observations)</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="linear-regression.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tests for finding influential observations</span></span>
<span id="cb9-2"><a href="linear-regression.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-3"><a href="linear-regression.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdp)</span>
<span id="cb9-4"><a href="linear-regression.html#cb9-4" aria-hidden="true" tabindex="-1"></a>lm.model<span class="ot">=</span><span class="fu">lm</span>(targetvar<span class="sc">~</span>.,<span class="at">data=</span>dataset)</span>
<span id="cb9-5"><a href="linear-regression.html#cb9-5" aria-hidden="true" tabindex="-1"></a>n.index <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(dataset))</span>
<span id="cb9-6"><a href="linear-regression.html#cb9-6" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">length</span>(lm.model<span class="sc">$</span>coefficients)</span>
<span id="cb9-7"><a href="linear-regression.html#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="linear-regression.html#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#i. Cook&#39;s D</span></span>
<span id="cb9-9"><a href="linear-regression.html#cb9-9" aria-hidden="true" tabindex="-1"></a>D.cut<span class="ot">=</span> <span class="dv">4</span><span class="sc">/</span>(<span class="fu">nrow</span>(dataset)<span class="sc">-</span>p<span class="dv">-1</span>)</span>
<span id="cb9-10"><a href="linear-regression.html#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="linear-regression.html#cb9-11" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="fu">ggplot</span>(lm.model,<span class="fu">aes</span>(<span class="at">x=</span>n.index,<span class="at">y=</span><span class="fu">cooks.distance</span>(lm.model))) <span class="sc">+</span></span>
<span id="cb9-12"><a href="linear-regression.html#cb9-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;orange&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-13"><a href="linear-regression.html#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">y=</span>D.cut) <span class="sc">+</span></span>
<span id="cb9-14"><a href="linear-regression.html#cb9-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Cook&#39;s D&quot;</span>,<span class="at">x =</span> <span class="st">&quot;Observation&quot;</span>,<span class="at">y =</span><span class="st">&quot;Cook&#39;s Distance&quot;</span>)</span>
<span id="cb9-15"><a href="linear-regression.html#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="linear-regression.html#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#ii. DFFITS</span></span>
<span id="cb9-17"><a href="linear-regression.html#cb9-17" aria-hidden="true" tabindex="-1"></a>df.cut<span class="ot">=</span><span class="dv">2</span><span class="sc">*</span>(<span class="fu">sqrt</span>((p)<span class="sc">/</span><span class="fu">nrow</span>(dataset)))</span>
<span id="cb9-18"><a href="linear-regression.html#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="linear-regression.html#cb9-19" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">ggplot</span>(lm.model,<span class="fu">aes</span>(<span class="at">x=</span>n.index,<span class="at">y=</span><span class="fu">dffits</span>(lm.model))) <span class="sc">+</span></span>
<span id="cb9-20"><a href="linear-regression.html#cb9-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;orange&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-21"><a href="linear-regression.html#cb9-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">y=</span>df.cut) <span class="sc">+</span></span>
<span id="cb9-22"><a href="linear-regression.html#cb9-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">y=</span><span class="sc">-</span>df.cut) <span class="sc">+</span></span>
<span id="cb9-23"><a href="linear-regression.html#cb9-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;DFFITS&quot;</span>,<span class="at">x=</span><span class="st">&quot;Observation&quot;</span>,<span class="at">y=</span><span class="st">&quot;DFFITS&quot;</span>)</span>
<span id="cb9-24"><a href="linear-regression.html#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="linear-regression.html#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Observations that are outside of dffits</span></span>
<span id="cb9-26"><a href="linear-regression.html#cb9-26" aria-hidden="true" tabindex="-1"></a>dataset[<span class="fu">dffits</span>(lm.model) <span class="sc">&gt;</span> df.cut <span class="sc">|</span> <span class="fu">dffits</span>(lm.model) <span class="sc">&lt;</span> <span class="sc">-</span>df.cut,]</span>
<span id="cb9-27"><a href="linear-regression.html#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="linear-regression.html#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co">#iii. DFBETAS (copy and paste for each variable)</span></span>
<span id="cb9-29"><a href="linear-regression.html#cb9-29" aria-hidden="true" tabindex="-1"></a>db.cut<span class="ot">=</span><span class="dv">2</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">nrow</span>(dataset))</span>
<span id="cb9-30"><a href="linear-regression.html#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="linear-regression.html#cb9-31" aria-hidden="true" tabindex="-1"></a>e <span class="ot">=</span> <span class="fu">ggplot</span>(lm.model,<span class="fu">aes</span>(<span class="at">x=</span>n.index,<span class="at">y=</span><span class="fu">dfbetas</span>(lm.model)[,<span class="st">&#39;variablename&#39;</span>])) <span class="sc">+</span> </span>
<span id="cb9-32"><a href="linear-regression.html#cb9-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;orange&quot;</span>) <span class="sc">+</span> </span>
<span id="cb9-33"><a href="linear-regression.html#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">y=</span>db.cut) <span class="sc">+</span> </span>
<span id="cb9-34"><a href="linear-regression.html#cb9-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">y=</span><span class="sc">-</span>db.cut) <span class="sc">+</span> </span>
<span id="cb9-35"><a href="linear-regression.html#cb9-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;DFBETA for variablename&quot;</span>,<span class="at">x=</span><span class="st">&quot;Observation&quot;</span>,<span class="at">y=</span><span class="st">&quot;DFBETAS&quot;</span>)</span>
<span id="cb9-36"><a href="linear-regression.html#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="linear-regression.html#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co">#iv. Hhat</span></span>
<span id="cb9-38"><a href="linear-regression.html#cb9-38" aria-hidden="true" tabindex="-1"></a>hat.cut<span class="ot">=</span><span class="dv">2</span><span class="sc">*</span>(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="fu">nrow</span>(dataset)</span>
<span id="cb9-39"><a href="linear-regression.html#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="linear-regression.html#cb9-40" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> <span class="fu">ggplot</span>(lm.model,<span class="fu">aes</span>(<span class="at">x=</span>n.index,<span class="at">y=</span><span class="fu">hatvalues</span>(lm.model))) <span class="sc">+</span></span>
<span id="cb9-41"><a href="linear-regression.html#cb9-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;orange&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-42"><a href="linear-regression.html#cb9-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">y=</span>hat.cut) <span class="sc">+</span></span>
<span id="cb9-43"><a href="linear-regression.html#cb9-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Hat values&quot;</span>,<span class="at">x=</span><span class="st">&quot;Observation&quot;</span>,<span class="at">y=</span><span class="st">&quot;Hat Values&quot;</span>)</span>
<span id="cb9-44"><a href="linear-regression.html#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="linear-regression.html#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="co">#Print all plots in a grid. Add additional variables for DFBETAS if desired</span></span>
<span id="cb9-46"><a href="linear-regression.html#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(c,d,e,f)</span></code></pre></div>
</div>
<div id="handle-outliers" class="section level3" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Handle Outliers</h3>
<p><span style="color:blue;"> <em>snippet fsr_outliers</em></span> <a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a></p>
<ol style="list-style-type: decimal">
<li>Recheck the data to ensure that no transcription or data entry errors
occurred.</li>
<li>If the data is valid, one possible explanation is that
the model is not adequate.
<ul>
<li>A model with higher-order terms, such as polynomials and interactions between the variables, might be necessary to fit the data well.</li>
<li>Nonlinear model</li>
</ul></li>
<li>Determine the robustness of the inference bv running the analysis both with and without the influential observations.</li>
<li>Robust Regression (Covered Later in Program)</li>
<li>Weighted Least Squares (WCS)</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="linear-regression.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tests for finding outliers</span></span>
<span id="cb10-2"><a href="linear-regression.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb10-3"><a href="linear-regression.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdp)</span>
<span id="cb10-4"><a href="linear-regression.html#cb10-4" aria-hidden="true" tabindex="-1"></a>lm.model<span class="ot">=</span><span class="fu">lm</span>(targetvar<span class="sc">~</span>.,<span class="at">data=</span>dataset)</span>
<span id="cb10-5"><a href="linear-regression.html#cb10-5" aria-hidden="true" tabindex="-1"></a>n.index <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(dataset))</span>
<span id="cb10-6"><a href="linear-regression.html#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="linear-regression.html#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#i. Internal Studentized Residuals</span></span>
<span id="cb10-8"><a href="linear-regression.html#cb10-8" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">ggplot</span>(lm.model,<span class="fu">aes</span>(<span class="at">x=</span>n.index,<span class="at">y=</span><span class="fu">rstandard</span>(lm.model))) <span class="sc">+</span> </span>
<span id="cb10-9"><a href="linear-regression.html#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;orange&quot;</span>) <span class="sc">+</span> </span>
<span id="cb10-10"><a href="linear-regression.html#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">y=</span><span class="sc">-</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb10-11"><a href="linear-regression.html#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">y=</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb10-12"><a href="linear-regression.html#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Internal Studentized Residuals&quot;</span>,<span class="at">x=</span><span class="st">&quot;Observation&quot;</span>,<span class="at">y=</span><span class="st">&quot;Residuals&quot;</span>)</span>
<span id="cb10-13"><a href="linear-regression.html#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="linear-regression.html#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#ii. External Studentized Residuals</span></span>
<span id="cb10-15"><a href="linear-regression.html#cb10-15" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">ggplot</span>(lm.model,<span class="fu">aes</span>(<span class="at">x=</span>n.index,<span class="at">y=</span><span class="fu">rstudent</span>(lm.model)))<span class="sc">+</span> </span>
<span id="cb10-16"><a href="linear-regression.html#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;orange&quot;</span>) <span class="sc">+</span> </span>
<span id="cb10-17"><a href="linear-regression.html#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">y=</span><span class="sc">-</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb10-18"><a href="linear-regression.html#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">y=</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb10-19"><a href="linear-regression.html#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;External Studentized Residuals&quot;</span>,<span class="at">x=</span><span class="st">&quot;Observation&quot;</span>,<span class="at">y=</span><span class="st">&quot;Residuals&quot;</span>)</span>
<span id="cb10-20"><a href="linear-regression.html#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="linear-regression.html#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(a,b)</span></code></pre></div>
</div>
</div>
<div id="variable-selection" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Variable Selection</h2>
<p><span style="color:blue;"> <em>snippet fsr_varselect_linreg</em></span> <a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a></p>
<p>When the data is postured and ready for analysis, start with variable selection. At this point you can choose between many selection techniques such as forward, backward, stepwise, and regularization (L1, L2, or elastic net). If you have a lot of variable you’re looking to cut back on, consider backward selection or variable clustering techniques. You also need to choose a model evaluation statistic of AIC, BIC, or p-value.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="linear-regression.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create training model</span></span>
<span id="cb11-2"><a href="linear-regression.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-3"><a href="linear-regression.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb11-4"><a href="linear-regression.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">19054</span>)</span>
<span id="cb11-5"><a href="linear-regression.html#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="linear-regression.html#cb11-6" aria-hidden="true" tabindex="-1"></a>dataframe <span class="ot">&lt;-</span> dataframe <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="co">#Only necessary if data does not have id-like column</span></span>
<span id="cb11-7"><a href="linear-regression.html#cb11-7" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> dataframe <span class="sc">%&gt;%</span> <span class="fu">sample_frac</span>(<span class="fl">0.7</span>) <span class="co">#70% of data points are set aside for training (can be changed)</span></span>
<span id="cb11-8"><a href="linear-regression.html#cb11-8" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(dataframe, train, <span class="at">by =</span> <span class="st">&#39;id&#39;</span>) <span class="co">#The remainder are assigned for testing</span></span>
<span id="cb11-9"><a href="linear-regression.html#cb11-9" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> train[,<span class="fu">c</span>(colnumstovalidate)] <span class="co">#Select columns you want to analyze</span></span>
<span id="cb11-10"><a href="linear-regression.html#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#train = train[,!(colnames(train) %in% &quot;id&quot;)] #Remove id column if not used in modeling</span></span>
<span id="cb11-11"><a href="linear-regression.html#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="linear-regression.html#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create full model and empty model</span></span>
<span id="cb11-13"><a href="linear-regression.html#cb11-13" aria-hidden="true" tabindex="-1"></a>full.model <span class="ot">=</span> <span class="fu">lm</span>(yvar <span class="sc">~</span> . , <span class="at">data =</span> train)</span>
<span id="cb11-14"><a href="linear-regression.html#cb11-14" aria-hidden="true" tabindex="-1"></a>empty.model <span class="ot">=</span> <span class="fu">lm</span>(yvar <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> train)</span>
<span id="cb11-15"><a href="linear-regression.html#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="linear-regression.html#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Information Criteria (InfCrit)</span></span>
<span id="cb11-17"><a href="linear-regression.html#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#AIC: k = 2</span></span>
<span id="cb11-18"><a href="linear-regression.html#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#BIC: k = log(nrow(train))</span></span>
<span id="cb11-19"><a href="linear-regression.html#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">#p-value: k = qchisq(alpha.f , 1, lower.tail = FALSE)</span></span>
<span id="cb11-20"><a href="linear-regression.html#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="linear-regression.html#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Create model</span></span>
<span id="cb11-22"><a href="linear-regression.html#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">#alpha.f=0.20 #Only needed for p-value calculation</span></span>
<span id="cb11-23"><a href="linear-regression.html#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="linear-regression.html#cb11-24" aria-hidden="true" tabindex="-1"></a>for.model <span class="ot">=</span> <span class="fu">step</span>(empty.model, <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">lower =</span> empty.model, <span class="at">upper =</span> full.model), <span class="at">direction =</span> <span class="st">&quot;forward&quot;</span>, <span class="at">k =</span> InfCrit)</span>
<span id="cb11-25"><a href="linear-regression.html#cb11-25" aria-hidden="true" tabindex="-1"></a>back.model <span class="ot">=</span> <span class="fu">step</span>(full.model, <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">lower =</span> empty.model, <span class="at">upper =</span> full.model), <span class="at">direction =</span> <span class="st">&quot;backward&quot;</span>, <span class="at">k =</span> InfCrit)</span>
<span id="cb11-26"><a href="linear-regression.html#cb11-26" aria-hidden="true" tabindex="-1"></a>step.model <span class="ot">=</span> <span class="fu">step</span>(empty.model, <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">lower =</span> empty.model, <span class="at">upper =</span> full.model), <span class="at">direction =</span> <span class="st">&quot;both&quot;</span>, <span class="at">k =</span> InfCrit)</span>
<span id="cb11-27"><a href="linear-regression.html#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="linear-regression.html#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Regularized regression for variable selection (LASSO example)</span></span>
<span id="cb11-29"><a href="linear-regression.html#cb11-29" aria-hidden="true" tabindex="-1"></a>train_x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(yvar <span class="sc">~</span> ., <span class="at">data =</span> train)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb11-30"><a href="linear-regression.html#cb11-30" aria-hidden="true" tabindex="-1"></a>train_y <span class="ot">&lt;-</span> train<span class="sc">$</span><span class="st">&#39;yvar&#39;</span></span>
<span id="cb11-31"><a href="linear-regression.html#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="linear-regression.html#cb11-32" aria-hidden="true" tabindex="-1"></a>train_lasso <span class="ot">=</span> <span class="fu">glmnet</span>(<span class="at">x=</span>train_x, <span class="at">y =</span> yvar, <span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb11-33"><a href="linear-regression.html#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train_lasso, <span class="at">xvar =</span> <span class="st">&quot;lambda&quot;</span>)</span></code></pre></div>
</div>
<div id="model-evaluation" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Model Evaluation</h2>
<p><span style="color:blue;"> <em>snippet fsr_modeval</em></span> <a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a></p>
<p>After the variables are selected, it’s time to run the linear regression. Evaluation metrics such as MAE, MAPE, RMSE, and MSE can be computed with the model output. Additionally, the chosen evaluation statistic (AIC, BIC, or adjusted r^2) and be computed on the validation set for comparison and on the test set (or the test rolled into the rest of the data) to report the final metrics.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="linear-regression.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Evaluate various metrics for model accuracy</span></span>
<span id="cb12-2"><a href="linear-regression.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb12-3"><a href="linear-regression.html#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="linear-regression.html#cb12-4" aria-hidden="true" tabindex="-1"></a>testdataset<span class="sc">$</span>pred_lm <span class="ot">&lt;-</span> <span class="fu">predict</span>(finalmodel, <span class="at">newdata =</span> testdataset)</span>
<span id="cb12-5"><a href="linear-regression.html#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="linear-regression.html#cb12-6" aria-hidden="true" tabindex="-1"></a>testdataset <span class="sc">%&gt;%</span> </span>
<span id="cb12-7"><a href="linear-regression.html#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lm_APE =</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>((yvar <span class="sc">-</span> pred_lm)<span class="sc">/</span>yvar)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="linear-regression.html#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lm_AE =</span> <span class="fu">abs</span>(yvar <span class="sc">-</span> pred_lm)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="linear-regression.html#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lm_SE =</span> (yvar <span class="sc">-</span> pred_lm)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-10"><a href="linear-regression.html#cb12-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">MAPE_lm =</span> <span class="fu">mean</span>(lm_APE)</span>
<span id="cb12-11"><a href="linear-regression.html#cb12-11" aria-hidden="true" tabindex="-1"></a>                            , <span class="at">MAE_lm =</span> <span class="fu">mean</span>(lm_AE)</span>
<span id="cb12-12"><a href="linear-regression.html#cb12-12" aria-hidden="true" tabindex="-1"></a>                            , <span class="at">MSE_lm =</span> <span class="fu">mean</span>(lm_SE)</span>
<span id="cb12-13"><a href="linear-regression.html#cb12-13" aria-hidden="true" tabindex="-1"></a>                            , <span class="at">RMSE_lm =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(lm_SE))</span>
<span id="cb12-14"><a href="linear-regression.html#cb12-14" aria-hidden="true" tabindex="-1"></a>                            , <span class="at">AIC_lm =</span> <span class="fu">AIC</span>(finalmodel)</span>
<span id="cb12-15"><a href="linear-regression.html#cb12-15" aria-hidden="true" tabindex="-1"></a>                            , <span class="at">BIC_lm =</span> <span class="fu">BIC</span>(finalmodel)</span>
<span id="cb12-16"><a href="linear-regression.html#cb12-16" aria-hidden="true" tabindex="-1"></a>                            , <span class="at">Ra2_lm =</span> <span class="fu">summary</span>(finalmodel)<span class="sc">$</span>adj.r.squared)</span></code></pre></div>
</div>
<div id="summarize-findings" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Summarize Findings</h2>
<p><a href="linear-regression.html#linear-regression" style="float:right">Back to Flowchart</a>
With these final metrics, you can summarize any business insights, findings, and takeaways based on the influential variables, model metrics, and business context.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="logistic-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/smjasper3/TRTADSF/edit/master/02-linear-regression.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/smjasper3/TRTADSF/blob/master/02-linear-regression.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
